@model BOBDrive.ViewModels.MonitorArchiveViewModel
@using BOBDrive.ViewModels
@{
    var breadcrumbs = ViewBag.Breadcrumbs as List<FolderItem> ?? new List<FolderItem>();

    // Bin root id passed from controller; 0 or null if not set
    var binFolderIdObj = ViewBag.BinFolderId;
    int binFolderId = 0;
    if (binFolderIdObj != null)
    {
        int.TryParse(binFolderIdObj.ToString(), out binFolderId);
    }

    // Current folder id is the last breadcrumb, if any
    var currentFolderId = breadcrumbs.Any() ? breadcrumbs.Last().Id : 0;
    bool isBinRoot = (binFolderId != 0 && currentFolderId == binFolderId);
}

<div>
    <!-- Breadcrumb -->
    <div class="breadcrumb" style="padding:8px 12px;margin-bottom:10px;">
        @if (!breadcrumbs.Any())
        {
            <span class="text-muted">/</span>
        }
        else
        {
            for (int i = 0; i < breadcrumbs.Count; i++)
            {
                var crumb = breadcrumbs[i];
                if (i > 0)
                {
                    @: &raquo;
                }

                if (i == breadcrumbs.Count - 1)
                {
                    <span>@crumb.Name</span>
                }
                else
                {
                    <a href="javascript:void(0);"
                       class="archive-breadcrumb-link"
                       data-folderid="@crumb.Id">
                        @crumb.Name
                    </a>
                }
            }
        }
    </div>

    <!-- Transfer / Delete controls -->
    <div class="form-inline" style="margin-bottom:10px;">
        <div class="form-group">
            <label for="targetUserExternalId">Transfer to user (ExternalUserId):</label>
            <input type="text" id="targetUserExternalId" class="form-control input-sm" placeholder="e.g. user@domain" />
        </div>

        @* On the Bin root itself, do not allow transfer/delete *@
        @if (!isBinRoot)
        {
            <button type="button" id="transferSelectedBtn" class="btn btn-sm btn-primary">
                Transfer Selected
            </button>
            <button type="button" id="deleteSelectedBtn" class="btn btn-sm btn-danger" style="margin-left:5px;">
                Delete Selected
            </button>
        }
        else
        {
            <span class="text-muted" style="margin-left:10px;">
                This is the Bin. Items here cannot be transferred or deleted.
            </span>
        }
    </div>

    <!-- Contents table -->
    <table class="table table-striped table-bordered table-condensed">
        <thead>
            <tr>
                <th style="width: 32px;">
                    @* On Bin root, no select-all because nothing is selectable *@
                    @if (!isBinRoot)
                    {
                        <input type="checkbox" id="selectAllArchiveItems" />
                    }
                </th>
                <th>Name</th>
                <th>Type</th>
                <th style="width: 120px;">Size</th>
                <th style="width: 160px;">Uploaded At</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var folder in Model.ChildFolders)
            {
                var isThisBinRoot = (binFolderId != 0 && folder.Id == binFolderId);
                <tr>
                    <td>
                        @* Do not render checkbox for the Bin root folder *@
                        @if (!isThisBinRoot && !isBinRoot)
                        {
                            <input type="checkbox"
                                   class="archive-select-checkbox"
                                   data-type="folder"
                                   data-id="@folder.Id" />
                        }
                    </td>
                    <td>
                        <i class="glyphicon glyphicon-folder-open"></i>
                        <a href="javascript:void(0);"
                           class="archive-folder-link"
                           data-folderid="@folder.Id">
                            @folder.Name
                        </a>
                    </td>
                    <td>Folder</td>
                    <td>-</td>
                    <td>-</td>
                </tr>
            }

            @foreach (var file in Model.ChildFiles)
            {
                <tr>
                    <td>
                        @* On Bin root, nothing is selectable *@
                        @if (!isBinRoot)
                        {
                            <input type="checkbox"
                                   class="archive-select-checkbox"
                                   data-type="file"
                                   data-id="@file.Id" />
                        }
                    </td>
                    <td>
                        <i class="glyphicon glyphicon-file"></i> @file.Name
                    </td>
                    <td>File</td>
                    <td>@String.Format("{0:0.00} MB", (double)file.Size / (1024 * 1024))</td>
                    <td>@file.UploadedAt.ToString("yyyy-MM-dd HH:mm")</td>
                </tr>
            }

            @if (!Model.ChildFolders.Any() && !Model.ChildFiles.Any())
            {
                <tr>
                    <td colspan="5">
                        <span class="text-muted">This folder is empty.</span>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>